#!/bin/bash

if [ "$#" -eq 0 ]; then
  echo "Usage: $0 <ip_address1> [<ip_address2> ...]"
  exit 1
fi
# collect the number of IPs
num_IPs=$(( $# ))
sleep_time=$((10 * num_IPs))
# collect the IP adresses in IPs variable
IPs=""
for ip in "$@"; do
  IPs="$IPs $ip"
done
# logging
log_path="/home/ubuntu/attack_logs/common_exploits.log"
log_server="10.10.2.74"

# Create a resource script to execute exploit in `msfconsole` 
# scan
echo "use auxiliary/scanner/netbios/nbname" > netbios_exploit_msfconsole.rc
echo "echo \"\$(date +'%Y-%m-%d %H:%M:%S.%N') exploit Netbios: Scanning\" | sshpass -p \"admin\" ssh ubuntu@$log_server \"cat >> $log_path\"" >> netbios_exploit_msfconsole.rc
echo "set RHOSTS $IPs" >> netbios_exploit_msfconsole.rc
echo "set RPORT 137" >> netbios_exploit_msfconsole.rc
echo "set threads 11" >> netbios_exploit_msfconsole.rc
echo "exploit -j" >> netbios_exploit_msfconsole.rc
# wait for exploit to finish
echo "sleep $sleep_time" >> netbios_exploit_msfconsole.rc
# exploit run
msfconsole -r netbios_exploit_msfconsole.rc